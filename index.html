<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        #score {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
        #instructions {
            position: fixed;
            top: 70px;
            left: 20px;
            font-size: 16px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <!-- Score and instructions display -->
    <div id="score">Score: 0 / 15</div>
    <div id="instructions">Find the hidden coin to reveal the next one!</div>

    <a-scene background="color: skyblue" vr-mode-ui="enabled: true">
      <!-- VR + Desktop Movement Camera Rig -->
<a-entity id="cameraRig"
          position="0 0 3"
          movement-controls="fly: false; constrainToNavMesh: false; speed: 0.1"
          wasd-controls="acceleration: 20; fly: false">
    
    <!-- Camera -->
    <a-camera position="0 1.6 0"
              look-controls="pointerLockEnabled: true">
        
        <!-- Cursor for desktop interaction -->
        <a-cursor position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: white; shader: flat"
                  animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                  raycaster="objects: .coin"
                  visible="true"></a-cursor>
    </a-camera>

    <!-- Left VR Controller (movement) -->
    <a-entity id="leftController"
              oculus-touch-controls="hand: left"
              thumbstick-logging
              raycaster="objects: .coin; lineColor: red; lineOpacity: 0.5">
    </a-entity>

    <!-- Right VR Controller (turning + raycaster) -->
    <a-entity id="rightController"
              oculus-touch-controls="hand: right"
              thumbstick-logging
              raycaster="objects: .coin; lineColor: blue; lineOpacity: 0.5"
              laser-controls>
    </a-entity>
</a-entity>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="point" position="0 10 0" color="white"></a-light>
        
        <!-- Island base -->
        <a-cylinder position="0 -1 0" radius="25" height="2" color="sandybrown"></a-cylinder>
        
        <!-- All your trees -->
        <a-cylinder position="5 2 -3" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="5 6.5 -3" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-8 2 2" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-8 6.5 2" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="10 2 8" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="10 6.5 8" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-5 2 -8" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-5 6.5 -8" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="15 2 -10" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="15 6.5 -10" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-12 2 -5" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-12 6.5 -5" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="8 2 -12" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="8 6.5 -12" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-15 2 8" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-15 6.5 8" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="3 2 12" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="3 6.5 12" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-3 2 15" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-3 6.5 15" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="18 2 3" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="18 6.5 3" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-10 2 12" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-10 6.5 12" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="12 2 -5" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="12 6.5 -5" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-6 2 -15" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-6 6.5 -15" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="20 2 -3" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="20 6.5 -3" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-18 2 -2" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-18 6.5 -2" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="7 2 18" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="7 6.5 18" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="-13 2 -12" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="-13 6.5 -12" radius="2" color="green"></a-sphere>
        
        <a-cylinder position="1 2 -18" radius="0.4" height="8" color="brown"></a-cylinder>
        <a-sphere position="1 6.5 -18" radius="2" color="green"></a-sphere>
        
        <!-- All your bushes -->
        <a-sphere position="2 1.2 -1" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="-4 1.2 4" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="6 1.2 2" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="-2 1.2 -6" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="9 1.2 -2" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="-7 1.2 -3" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="4 1.2 7" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="-1 1.2 9" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="11 1.2 5" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="-9 1.2 7" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="14 1.2 -7" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="-11 1.2 -9" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="8 1.2 14" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="-16 1.2 3" radius="1.2" color="darkgreen"></a-sphere>
        <a-sphere position="0 1.2 -11" radius="1.2" color="darkgreen"></a-sphere>
        
        <!-- Container for dynamically created coins -->
        <a-entity id="coin-container"></a-entity>
    </a-scene>

    <script>
        // Register custom component for thumbstick movement
        AFRAME.registerComponent('thumbstick-logging', {
            init: function () {
                this.el.addEventListener('thumbstickmoved', this.logThumbstick);
            },
            logThumbstick: function (evt) {
                const cameraRig = document.querySelector('#cameraRig');
                const camera = document.querySelector('a-camera');
                
                if (evt.detail.x !== undefined && evt.detail.y !== undefined) {
                    // Get current positions
                    const rigPosition = cameraRig.getAttribute('position');
                    const cameraRotation = camera.getAttribute('rotation');
                    
                    // Movement speed
                    const speed = 0.1;
                    
                    // Calculate movement based on camera direction
                    const yRotation = THREE.MathUtils.degToRad(cameraRotation.y);
                    
                    // Left controller - movement
                    if (this.el.id === 'leftController') {
                        const deltaX = evt.detail.x * speed;
                        const deltaZ = -evt.detail.y * speed;
                        
                        // Apply rotation to movement
                        const newX = rigPosition.x + (deltaX * Math.cos(yRotation) - deltaZ * Math.sin(yRotation));
                        const newZ = rigPosition.z + (deltaX * Math.sin(yRotation) + deltaZ * Math.cos(yRotation));
                        
                        cameraRig.setAttribute('position', {
                            x: newX,
                            y: rigPosition.y,
                            z: newZ
                        });
                    }
                    
                    // Right controller - turning
                    if (this.el.id === 'rightController') {
                        const turnSpeed = 2;
                        const newRotationY = cameraRotation.y + (evt.detail.x * turnSpeed);
                        
                        camera.setAttribute('rotation', {
                            x: cameraRotation.x,
                            y: newRotationY,
                            z: cameraRotation.z
                        });
                    }
                }
            }
        });

        let score = 0;
        const scoreElement = document.getElementById('score');
        const instructionsElement = document.getElementById('instructions');
        
        // 15 possible coin locations
        const coinLocations = [
            "3 0.2 1", "-7 0.2 -1", "13 0.2 6", "-5 0.2 10", "16 0.2 -8",
            "-14 0.2 -7", "7 0.2 -4", "-1 0.2 -13", "19 0.2 8", "-17 0.2 -10",
            "2 0.2 -16", "-12 0.2 14", "22 0.2 -1", "-8 0.2 -20", "6 0.2 21"
        ];
        
        // Shuffle the locations randomly
        let shuffledLocations = [...coinLocations];
        for (let i = shuffledLocations.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledLocations[i], shuffledLocations[j]] = [shuffledLocations[j], shuffledLocations[i]];
        }
        
        let currentCoinIndex = 0;
        let currentCoin = null;
        
        function createNextCoin() {
            if (currentCoinIndex < 15) {
                const coinContainer = document.getElementById('coin-container');
                
                // Create new coin element
                const coin = document.createElement('a-cylinder');
                coin.setAttribute('class', 'coin');
                coin.setAttribute('position', shuffledLocations[currentCoinIndex]);
                coin.setAttribute('radius', '0.08');
                coin.setAttribute('height', '0.02');
                coin.setAttribute('color', '#DAA520');
                coin.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 3000');
                
                // Add click listener for both desktop and VR
                coin.addEventListener('click', handleCoinClick);
                coin.addEventListener('raycaster-intersected', function() {
                    this.setAttribute('color', '#FFD700');
                });
                coin.addEventListener('raycaster-intersected-cleared', function() {
                    this.setAttribute('color', '#DAA520');
                });
                
                // Add to scene
                coinContainer.appendChild(coin);
                currentCoin = coin;
            }
        }
        
        function handleCoinClick() {
            // Remove the coin
            this.remove();
            
            // Add to score
            score += 1;
            scoreElement.textContent = `Score: ${score} / 15`;
            
            // Move to next coin
            currentCoinIndex += 1;
            
            if (score < 15) {
                instructionsElement.textContent = `Great! Find coin ${score + 1} of 15`;
                setTimeout(() => {
                    createNextCoin();
                }, 500);
            } else {
                instructionsElement.textContent = 'Amazing! All coins found!';
                setTimeout(() => {
                    alert('Congratulations! You found all 15 treasure coins!');
                }, 100);
            }
        }
        
        // Start the game
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                createNextCoin();
            }, 1000);
        });
    </script>
</body>
</html>
